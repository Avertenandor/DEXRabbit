const { test, expect } = require('@playwright/test');
const {
  humanPause,
  openMobileMenu,
  openDropdown,
  clickDropdownLink,
  verifyPage,
  readPageContent,
  goBack,
  fullPageCheck,
  clickExternalLink
} = require('../helpers/user-actions');

/**
 * –ü–†–û–ú–´–®–õ–ï–ù–ù–´–ô –¢–ï–°–¢: –ü–£–¢–¨ –ò–ù–í–ï–°–¢–û–†–ê
 * 
 * –°—Ü–µ–Ω–∞—Ä–∏–π:
 * 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
 * 2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
 * 3. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏" ‚Üí "–ú–æ–¥–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
 * 4. –ß–∏—Ç–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–æ–¥–µ–ª–∏
 * 5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞–∑–∞–¥
 * 6. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ "–ì–∞—Ä–∞–Ω—Ç–∏–∏"
 * 7. –ò–∑—É—á–∞–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏
 * 8. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞–∑–∞–¥
 * 9. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ "–°—Ç–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º"
 * 10. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –±–æ—Ç
 */

test.describe('–ü–†–û–ú–´–®–õ–ï–ù–ù–´–ô –¢–ï–°–¢: –ü—É—Ç—å –ò–Ω–≤–µ—Å—Ç–æ—Ä–∞', () => {
  
  test('–ò–Ω–≤–µ—Å—Ç–æ—Ä: –æ—Ç –≥–ª–∞–≤–Ω–æ–π –¥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', async ({ page }) => {
    console.log('\nüéØ –ù–ê–ß–ê–õ–û –¢–ï–°–¢–ê: –ü–£–¢–¨ –ò–ù–í–ï–°–¢–û–†–ê\n');
    
    // ========== –®–ê–ì 1: –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã ==========
    console.log('üìç –®–ê–ì 1: –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
    await page.goto('/');
    await page.waitForLoadState('networkidle');
    await fullPageCheck(page, '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞');
    await humanPause(2000); // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è
    
    // ========== –®–ê–ì 2: –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é ==========
    console.log('\nüìç –®–ê–ì 2: –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é');
    await openMobileMenu(page);
    await humanPause(1000); // –°–º–æ—Ç—Ä–∏–º –Ω–∞ –º–µ–Ω—é
    
    // ========== –®–ê–ì 3: –û—Ç–∫—Ä—ã—Ç–∏–µ dropdown "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏" ==========
    console.log('\nüìç –®–ê–ì 3: –û—Ç–∫—Ä—ã—Ç–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏');
    await openDropdown(page, '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏');
    await humanPause(1500); // –°–º–æ—Ç—Ä–∏–º –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç—ã
    
    // ========== –®–ê–ì 4: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ "–ú–æ–¥–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è" ==========
    console.log('\nüìç –®–ê–ì 4: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ú–æ–¥–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
    await clickDropdownLink(page, '–ú–æ–¥–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
    await verifyPage(page, '/investment-model.html', '–ú–æ–¥–µ–ª—å');
    await fullPageCheck(page, '–ú–æ–¥–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
    
    // ========== –®–ê–ì 5: –ß—Ç–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ ==========
    console.log('\nüìç –®–ê–ì 5: –ß—Ç–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥–µ–ª–∏');
    await readPageContent(page, 3000); // –î–æ–ª–≥–æ —á–∏—Ç–∞–µ–º
    
    // ========== –®–ê–ì 6: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é ==========
    console.log('\nüìç –®–ê–ì 6: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é');
    await goBack(page);
    await verifyPage(page, '/', 'DEXRabbit');
    await humanPause(1000);
    
    // ========== –®–ê–ì 7: –û—Ç–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é —Å–Ω–æ–≤–∞ ==========
    console.log('\nüìç –®–ê–ì 7: –û—Ç–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é —Å–Ω–æ–≤–∞');
    await openMobileMenu(page);
    await humanPause(800);
    
    // ========== –®–ê–ì 8: –û—Ç–∫—Ä—ã—Ç–∏–µ dropdown "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏" —Å–Ω–æ–≤–∞ ==========
    console.log('\nüìç –®–ê–ì 8: –û—Ç–∫—Ä—ã—Ç–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ —Å–Ω–æ–≤–∞');
    await openDropdown(page, '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏');
    await humanPause(1000);
    
    // ========== –®–ê–ì 9: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ "–ì–∞—Ä–∞–Ω—Ç–∏–∏" ==========
    console.log('\nüìç –®–ê–ì 9: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ì–∞—Ä–∞–Ω—Ç–∏–∏');
    await clickDropdownLink(page, '–ì–∞—Ä–∞–Ω—Ç–∏–∏');
    await verifyPage(page, '/guarantees.html', '–ì–∞—Ä–∞–Ω—Ç–∏–∏');
    await fullPageCheck(page, '–ì–∞—Ä–∞–Ω—Ç–∏–∏');
    
    // ========== –®–ê–ì 10: –ß—Ç–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–π ==========
    console.log('\nüìç –®–ê–ì 10: –ò–∑—É—á–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–π');
    await readPageContent(page, 2500);
    
    // ========== –®–ê–ì 11: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é ==========
    console.log('\nüìç –®–ê–ì 11: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é');
    await goBack(page);
    await verifyPage(page, '/', 'DEXRabbit');
    await humanPause(1000);
    
    // ========== –®–ê–ì 12: –û—Ç–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é —Ç—Ä–µ—Ç–∏–π —Ä–∞–∑ ==========
    console.log('\nüìç –®–ê–ì 12: –û—Ç–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é —Ç—Ä–µ—Ç–∏–π —Ä–∞–∑');
    await openMobileMenu(page);
    await humanPause(800);
    
    // ========== –®–ê–ì 13: –û—Ç–∫—Ä—ã—Ç–∏–µ dropdown "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏" —Ç—Ä–µ—Ç–∏–π —Ä–∞–∑ ==========
    console.log('\nüìç –®–ê–ì 13: –û—Ç–∫—Ä—ã—Ç–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ —Ç—Ä–µ—Ç–∏–π —Ä–∞–∑');
    await openDropdown(page, '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏');
    await humanPause(1000);
    
    // ========== –®–ê–ì 14: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ "–°—Ç–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º" ==========
    console.log('\nüìç –®–ê–ì 14: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –°—Ç–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º');
    await clickDropdownLink(page, '–°—Ç–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º');
    await verifyPage(page, '/investors.html', '–ò–Ω–≤–µ—Å—Ç–æ—Ä');
    await fullPageCheck(page, '–°—Ç–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º');
    
    // ========== –®–ê–ì 15: –ß—Ç–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ ==========
    console.log('\nüìç –®–ê–ì 15: –ò–∑—É—á–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤');
    await readPageContent(page, 3000);
    
    // ========== –®–ê–ì 16: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ –±–æ—Ç ==========
    console.log('\nüìç –®–ê–ì 16: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ Telegram –±–æ—Ç');
    const botLink = await clickExternalLink(page, '–û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç');
    expect(botLink).toContain('t.me/dexrabbit_bot');
    
    // ========== –§–ò–ù–ê–õ ==========
    console.log('\n‚úÖ –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù: –ü–£–¢–¨ –ò–ù–í–ï–°–¢–û–†–ê –£–°–ü–ï–®–ù–û –ü–†–û–ô–î–ï–ù');
    console.log('üìä –í—Å–µ–≥–æ —à–∞–≥–æ–≤: 16');
    console.log('‚è±Ô∏è –≠–º—É–ª—è—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞\n');
  });
  
  test('–ò–Ω–≤–µ—Å—Ç–æ—Ä: –±—ã—Å—Ç—Ä—ã–π –ø—É—Ç—å (–±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤)', async ({ page }) => {
    console.log('\nüéØ –ù–ê–ß–ê–õ–û –¢–ï–°–¢–ê: –ë–´–°–¢–†–´–ô –ü–£–¢–¨ –ò–ù–í–ï–°–¢–û–†–ê\n');
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–π
    await page.goto('/');
    await page.waitForLoadState('networkidle');
    await humanPause(1000);
    
    // –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é ‚Üí –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ ‚Üí –ú–æ–¥–µ–ª—å
    await openMobileMenu(page);
    await openDropdown(page, '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏');
    await clickDropdownLink(page, '–ú–æ–¥–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
    await fullPageCheck(page, '–ú–æ–¥–µ–ª—å (–±—ã—Å—Ç—Ä—ã–π –ø—É—Ç—å)');
    
    // –°—Ä–∞–∑—É –Ω–∞ –°—Ç–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º —á–µ—Ä–µ–∑ nav
    await page.goto('/investors.html');
    await page.waitForLoadState('networkidle');
    await fullPageCheck(page, '–ò–Ω–≤–µ—Å—Ç–æ—Ä—ã (–±—ã—Å—Ç—Ä—ã–π –ø—É—Ç—å)');
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ—Ç–∞
    const botLink = await clickExternalLink(page, '–û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç');
    expect(botLink).toContain('t.me');
    
    console.log('\n‚úÖ –ë–´–°–¢–†–´–ô –ü–£–¢–¨ –ü–†–û–ô–î–ï–ù\n');
  });
  
  test('–ò–Ω–≤–µ—Å—Ç–æ—Ä: –∏–∑—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤', async ({ page }) => {
    console.log('\nüéØ –ù–ê–ß–ê–õ–û –¢–ï–°–¢–ê: –ü–û–õ–ù–û–ï –ò–ó–£–ß–ï–ù–ò–ï –ò–ù–í–ï–°–¢–ò–¶–ò–ô\n');
    
    await page.goto('/');
    await page.waitForLoadState('networkidle');
    
    await openMobileMenu(page);
    await openDropdown(page, '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏');
    
    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Å—Å—ã–ª–∫–∞–º –≤ dropdown
    const links = [
      { text: '–ú–æ–¥–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', url: '/investment-model.html' },
      { text: '–°—Ç–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º', url: '/investors.html' },
      { text: '–ì–∞—Ä–∞–Ω—Ç–∏–∏', url: '/guarantees.html' },
      { text: '–û—Ç—á—ë—Ç—ã', url: '/reports.html' }
    ];
    
    for (const link of links) {
      console.log(`\nüìÑ –ò–∑—É—á–∞–µ–º: ${link.text}`);
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–≤–∞—è —Å—Å—ã–ª–∫–∞
      if (links.indexOf(link) > 0) {
        await page.goto('/');
        await page.waitForLoadState('networkidle');
        await openMobileMenu(page);
        await openDropdown(page, '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏');
      }
      
      await clickDropdownLink(page, link.text);
      await verifyPage(page, link.url);
      await readPageContent(page, 2000);
      await fullPageCheck(page, link.text);
    }
    
    console.log('\n‚úÖ –í–°–ï –†–ê–ó–î–ï–õ–´ –ò–ù–í–ï–°–¢–ò–¶–ò–ô –ò–ó–£–ß–ï–ù–´\n');
  });
});
