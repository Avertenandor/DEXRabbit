/**
 * DEXRabbit - –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å –º–µ–≥–∞-–º–µ–Ω—é
 * –í–µ—Ä—Å–∏—è 3.0 - –ú–µ–≥–∞-–º–µ–Ω—é —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
 */

window.DEXRabbitNav = {
  // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–≥–∞-–º–µ–Ω—é —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
  megaMenu: [
    {
      title: '–ì–ª–∞–≤–Ω–∞—è',
      href: '/',
      single: true, // –ë–µ–∑ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–æ–≤
    },
    {
      title: '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏',
      category: 'investment',
      icon: 'üí∞',
      items: [
        {
          title: '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å',
          href: '/investment-model.html',
          description: '–ö—Ä—É–≥–∏ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è –ê –∏ –ë',
          icon: 'üìä',
        },
        {
          title: '–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å',
          href: '/#investment',
          description: '–†–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏ –∏ ROI',
          icon: 'üìà',
        },
        {
          title: '–ì–∞—Ä–∞–Ω—Ç–∏–∏',
          href: '/#guarantees',
          description: '–ó–∞—â–∏—Ç–∞ –≤–∞—à–∏—Ö –≤–ª–æ–∂–µ–Ω–∏–π',
          icon: 'üõ°Ô∏è',
        },
        {
          title: 'PLEX —Ç–æ–∫–µ–Ω',
          href: '/#tokenization',
          description: '–ö—É—Ä—Å –∏ —ç–∫–æ–Ω–æ–º–∏–∫–∞ —Ç–æ–∫–µ–Ω–∞',
          icon: 'ü™ô',
        },
        {
          title: '–ù–∞—à–∏ –∏–Ω–≤–µ—Å—Ç–æ—Ä—ã',
          href: '/investors.html',
          description: '–†–µ–∞–ª—å–Ω—ã–µ –æ—Ç–∑—ã–≤—ã',
          icon: 'üë•',
        },
      ],
    },
    {
      title: '–ü–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ',
      category: 'partnership',
      icon: 'ü§ù',
      items: [
        {
          title: '–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞',
          href: '/partnership.html',
          description: '3 —É—Ä–æ–≤–Ω—è, 5% –Ω–∞ –∫–∞–∂–¥–æ–º',
          icon: 'üíµ',
        },
        {
          title: '–î–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤',
          href: '/restaurants.html',
          description: '–ü—Ä—è–º—ã–µ –ø–æ—Å—Ç–∞–≤–∫–∏ –º—è—Å–∞',
          icon: 'üçΩÔ∏è',
        },
        {
          title: '–î–ª—è –±–ª–æ–≥–µ—Ä–æ–≤',
          href: '/#contacts',
          description: '–ü–æ–≤—ã—à–µ–Ω–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏',
          icon: 'üìπ',
        },
        {
          title: '–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä—Ç–Ω–µ—Ä—ã',
          href: '/#partners',
          description: '–ù–∞—à–∏ –ø–∞—Ä—Ç–Ω–µ—Ä—ã',
          icon: 'ü§ù',
        },
      ],
    },
    {
      title: '–£—Å–ª—É–≥–∏',
      category: 'services',
      icon: 'üê∞',
      items: [
        {
          title: '–ö—Ä–æ–ª–∏–∫ –≤ –ø–æ–¥–∞—Ä–æ–∫',
          href: '/gifts.html',
          description: '–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫',
          icon: 'üéÅ',
        },
        {
          title: '–ü–ª–µ–º–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞',
          href: '/breeding.html',
          description: '–°–µ–ª–µ–∫—Ü–∏—è –∏ —Ä–∞–∑–≤–µ–¥–µ–Ω–∏–µ',
          icon: 'üß¨',
        },
        {
          title: '–ö—Ä–æ–ª–∏–∫–æ—Ç–µ—Ä–∞–ø–∏—è',
          href: '/therapy.html',
          description: '–¢–µ—Ä–∞–ø–∏—è —Å –∫—Ä–æ–ª–∏–∫–∞–º–∏',
          icon: 'üíÜ',
        },
        {
          title: '–£—Ö–æ–¥ –∑–∞ –∫—Ä–æ–ª–∏–∫–∞–º–∏',
          href: '/care.html',
          description: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ö–æ–¥',
          icon: 'üè•',
        },
        {
          title: '–õ–æ–≥–∏—Å—Ç–∏–∫–∞',
          href: '/logistics.html',
          description: '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†–æ—Å—Å–∏–∏',
          icon: 'üöö',
        },
        {
          title: '–ö—Ä–æ–ª–∏–∫–∏ –∏ –∑–∞–π—Ü—ã',
          href: '/rabbits-hares.html',
          description: '–û—Ç–ª–∏—á–∏—è –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏',
          icon: 'üê∞',
        },
        {
          title: '–ö—Ä–æ–ª–∏–∫–∏ –∏ –∫–æ—à–∫–∏',
          href: '/cats-rabbits.html',
          description: '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å',
          icon: 'üê±',
        },
      ],
    },
    {
      title: '–û –Ω–∞—Å',
      category: 'about',
      items: [
        {
          title: '–û –ø—Ä–æ–µ–∫—Ç–µ',
          href: '/#about',
          description: '–ú–∏—Å—Å–∏—è –∏ —Ü–µ–ª–∏',
          icon: 'üèÜ',
        },
        {
          title: '–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç',
          href: '/#how-it-works',
          description: '–ú–µ—Ö–∞–Ω–∏–∫–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è',
          icon: '‚öôÔ∏è',
        },
        {
          title: '–ì–∞–ª–µ—Ä–µ—è',
          href: '/#gallery',
          description: '–§–æ—Ç–æ –Ω–∞—à–∏—Ö –∫—Ä–æ–ª–∏–∫–æ–≤',
          icon: 'üì∑',
        },
        {
          title: '–û—Ç—á–µ—Ç—ã',
          href: '/reports.html',
          description: '–í–∏–¥–µ–æ —Å —Ñ–µ—Ä–º—ã',
          icon: 'üìπ',
        },
        {
          title: '–†–∞–∑–≤–∏—Ç–∏–µ',
          href: '/#development',
          description: '–ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ',
          icon: 'üöÄ',
        },
        {
          title: '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
          href: '/#contacts',
          description: '–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏',
          icon: 'üìû',
        },
      ],
    },
  ],

  // CTA –∫–Ω–æ–ø–∫–∞
  cta: {
    title: 'üí¨ –ù–∞—á–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å',
    href: 'https://t.me/dexrabbit_bot',
    external: true,
  },

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML –¥–ª—è –º–µ–≥–∞-–º–µ–Ω—é (—Ç–æ–ª—å–∫–æ —Ç—Ä–∏–≥–≥–µ—Ä—ã)
   */
  renderMegaMenu() {
    const currentPath = window.location.pathname;

    return this.megaMenu
      .map(category => {
        // –ï—Å–ª–∏ —ç—Ç–æ –æ–¥–∏–Ω–æ—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ –±–µ–∑ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–æ–≤
        if (category.single) {
          const isActive = currentPath === category.href || currentPath === '/index.html';
          return `
            <div class="mega-nav-item">
              <a href="${category.href}" class="mega-nav-link${isActive ? ' active' : ''}">
                ${category.title}
              </a>
            </div>
          `;
        }

        // –ò–Ω–∞—á–µ —ç—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞–º–∏ - –¢–û–õ–¨–ö–û –¢–†–ò–ì–ì–ï–†
        return `
          <div class="mega-nav-item">
            <button 
              class="mega-trigger" 
              data-target="#mega-panel-${category.category}"
              aria-haspopup="true" 
              aria-expanded="false"
            >
              ${category.icon ? category.icon + ' ' : ''}${category.title}
              <span class="mega-arrow">‚ñæ</span>
            </button>
          </div>
        `;
      })
      .join('');
  },

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML –¥–ª—è –ø–∞–Ω–µ–ª–µ–π (–æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤)
   */
  renderMegaPanels() {
    return this.megaMenu
      .filter(category => !category.single) // –¢–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞–º–∏
      .map(category => `
        <div 
          class="mega-panel" 
          id="mega-panel-${category.category}"
          role="menu"
          aria-hidden="true"
          style="display: none;"
        >
          <div class="mega-panel-content">
            <div class="mega-panel-grid">
              ${category.items
                .map(
                  item => `
                <a 
                  href="${item.href}" 
                  class="mega-panel-item" 
                  role="menuitem"
                >
                  <span class="mega-item-icon">${item.icon}</span>
                  <div class="mega-item-content">
                    <span class="mega-item-title">${item.title}</span>
                    <span class="mega-item-desc">${item.description}</span>
                  </div>
                </a>
              `
                )
                .join('')}
            </div>
          </div>
        </div>
      `)
      .join('');
  },

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML –¥–ª—è CTA –∫–Ω–æ–ø–∫–∏
   */
  renderCTA() {
    const external = this.cta.external ? 'target="_blank" rel="noopener noreferrer"' : '';
    return `
      <a href="${this.cta.href}" 
         class="btn btn-primary nav-cta" 
         ${external}>
        ${this.cta.title}
      </a>
    `;
  },

  /**
   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–µ–≥–∞-–º–µ–Ω—é –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
   */
  init() {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DEXRabbitNav Mega Menu...');

    const navContainer = document.querySelector('.mega-nav-container');
    const navWrapper = document.querySelector('.nav-wrapper');

    if (navContainer) {
      // 1) –†–µ–Ω–¥–µ—Ä–∏–º —Ç–æ–ª—å–∫–æ —Ç—Ä–∏–≥–≥–µ—Ä—ã –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é
      navContainer.innerHTML = this.renderMegaMenu();
      console.log('‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã –º–µ–≥–∞-–º–µ–Ω—é —Å–æ–∑–¥–∞–Ω—ã');
    } else {
      console.warn('‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä .mega-nav-container –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }

    if (navWrapper) {
      // 2) –†–µ–Ω–¥–µ—Ä–∏–º –ø–∞–Ω–µ–ª–∏ –°–†–ê–ó–£ –≤ .nav-wrapper
      navWrapper.insertAdjacentHTML('beforeend', this.renderMegaPanels());
      console.log('‚úÖ –ü–∞–Ω–µ–ª–∏ –º–µ–≥–∞-–º–µ–Ω—é —Å–æ–∑–¥–∞–Ω—ã –≤ .nav-wrapper');
    } else {
      console.warn('‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä .nav-wrapper –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º CTA –∫–Ω–æ–ø–∫—É
    const ctaContainer = document.querySelector('.nav-cta-wrapper');
    if (ctaContainer) {
      ctaContainer.innerHTML = this.renderCTA();
      console.log('‚úÖ CTA –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    this.initMegaMenuInteractions();
  },

  /**
   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–µ–≥–∞-–º–µ–Ω—é
   */
  initMegaMenuInteractions() {
    const WRAPPER = document.querySelector('.nav-wrapper');
    if (!WRAPPER) {
      console.warn('‚ö†Ô∏è .nav-wrapper –Ω–µ –Ω–∞–π–¥–µ–Ω');
      return;
    }

    // 1) –í–´–†–ï–ó–ê–ï–ú –ü–ê–ù–ï–õ–ò –ò–ó –ù–ê–í–ò–ì–ê–¶–ò–ò (–µ—Å–ª–∏ —Ç–∞–º –æ—Å—Ç–∞–ª–∏—Å—å) –ò –ü–ï–†–ï–ù–û–°–ò–ú –í WRAPPER
    const navContainer = document.querySelector('.mega-nav-container');
    if (navContainer) {
      navContainer.querySelectorAll('.mega-panel').forEach(panel => {
        WRAPPER.appendChild(panel);
        console.log('‚úÖ –ü–∞–Ω–µ–ª—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –∏–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ .nav-wrapper');
      });
    }

    // 2) –°–í–Ø–ó–´–í–ê–ï–ú –¢–†–ò–ì–ì–ï–†–´ –° –ü–ê–ù–ï–õ–Ø–ú–ò –ü–û data-target
    WRAPPER.addEventListener('click', (e) => {
      const trigger = e.target.closest('.mega-trigger');
      if (!trigger) return;
      
      const targetId = trigger.getAttribute('data-target');
      const panel = targetId ? document.querySelector(targetId) : null;
      if (!panel) return;

      // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –ø–∞–Ω–µ–ª–∏
      WRAPPER.querySelectorAll('.mega-panel[aria-hidden="false"]').forEach(p => {
        p.setAttribute('aria-hidden', 'true');
        p.style.display = 'none';
      });

      // –û—Ç–∫—Ä—ã—Ç—å –Ω—É–∂–Ω—É—é –ø–∞–Ω–µ–ª—å
      panel.style.display = 'block';
      panel.setAttribute('aria-hidden', 'false');
      trigger.setAttribute('aria-expanded', 'true');
      
      console.log('‚úÖ –ü–∞–Ω–µ–ª—å –æ—Ç–∫—Ä—ã—Ç–∞:', targetId);
    });

    // 3) –ö–ª–∏–∫ –≤–Ω–µ ‚Äî –∑–∞–∫—Ä—ã—Ç—å –≤—Å–µ
    document.addEventListener('click', (e) => {
      if (e.target.closest('.mega-trigger') || e.target.closest('.mega-panel')) return;
      
      WRAPPER.querySelectorAll('.mega-panel').forEach(panel => {
        panel.setAttribute('aria-hidden', 'true');
        panel.style.display = 'none';
      });
      
      // –°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
      document.querySelectorAll('.mega-trigger').forEach(trigger => {
        trigger.setAttribute('aria-expanded', 'false');
      });
    });

    console.log('‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–µ–≥–∞-–º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ (–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞)');
  },
};

// –ê–≤—Ç–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    window.DEXRabbitNav.init();
  });
} else {
  setTimeout(() => {
    window.DEXRabbitNav.init();
  }, 100);
}

console.log('‚úÖ navigation-data.js v3.0 (Mega Menu) –∑–∞–≥—Ä—É–∂–µ–Ω');
