/* ========== РЕФАКТОРИНГ НАВИГАЦИИ БЕЗ !IMPORTANT ========== */
/* Версия: 20251001-refactor */

/* ========== ОСНОВНЫЕ СТИЛИ НАВИГАЦИИ ========== */
.nav-wrapper {
  position: relative;
  max-width: 1200px;
  margin-inline: auto;
  padding-inline: 16px;
}

.navbar-inner {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 2rem;
  padding-block: clamp(1rem, 2vw, 2rem);
  padding-left: 1rem;
  min-height: 60px;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.4));
  border-radius: 16px;
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

/* ========== ЭЛЕМЕНТЫ НАВИГАЦИИ ========== */
.logo-wrapper {
  flex-shrink: 0;
  margin-right: 0;
}

.mega-nav-container {
  flex: 1;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  margin: 0;
  padding: 0;
  gap: 0.75rem;
  flex-wrap: wrap;
  max-width: calc(100% - 200px);
}

.nav-cta-wrapper {
  flex-shrink: 0;
  margin-left: auto;
}

/* ========== МЕГА-ПАНЕЛЬ ========== */
.mega-panel {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  width: min(1100px, 96vw);
  z-index: 1000;
  max-height: min(600px, 70vh);
  overflow: auto;
  display: none;
  margin-top: 8px;
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(20px);
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.9));
  border: 1px solid rgba(124, 140, 255, 0.2);
}

.mega-panel.active {
  display: block;
  opacity: 1;
  visibility: visible;
}

/* ========== АДАПТИВНОСТЬ ========== */
@media (max-width: 1024px) {
  .mega-panel {
    left: 0;
    transform: none;
    width: 100%;
    border-radius: 0 0 14px 14px;
    max-width: 800px;
    margin: 0 auto;
  }
  
  .navbar-inner {
    padding-block: 1.5rem;
    gap: 1.5rem;
  }
  
  .mega-nav-container {
    gap: 0.5rem;
    max-width: calc(100% - 150px);
  }
}

@media (max-width: 768px) {
  .navbar-inner {
    padding-block: 1rem;
    gap: 1rem;
    min-height: 50px;
  }
  
  .mega-nav-container {
    gap: 0.25rem;
    max-width: calc(100% - 120px);
  }
  
  .mega-panel {
    max-height: min(500px, 60vh);
  }
}

/* ========== БЕЗОПАСНЫЕ ЗОНЫ ДЛЯ IPHONE ========== */
@supports (padding: max(0px)) {
  .navbar {
    padding-top: max(1rem, env(safe-area-inset-top));
  }
  
  .footer {
    padding-bottom: max(1rem, env(safe-area-inset-bottom));
  }
}

/* ========== УЛУЧШЕНИЕ КОНТРАСТНОСТИ ========== */
.mega-item-desc {
  color: rgba(200, 200, 200, 0.9);
  font-size: 0.875rem;
}

.mega-panel-item {
  color: rgba(255, 255, 255, 0.95);
}

.mega-panel-item:hover {
  color: #facc15;
  background: rgba(124, 140, 255, 0.1);
}

/* ========== РАЗМЕРЫ КНОПОК ДЛЯ МОБИЛЬНЫХ ========== */
@media (max-width: 900px) {
  .mega-trigger {
    min-height: 44px;
    min-width: 44px;
    padding: 0.75rem 1.25rem;
    font-size: 0.875rem;
  }
  
  .mega-panel-item {
    min-height: 44px;
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
  }
}

/* ========== ОПТИМИЗАЦИЯ ПРОИЗВОДИТЕЛЬНОСТИ ========== */
.mega-panel {
  will-change: auto;
}

.mega-panel.animating {
  will-change: transform, opacity;
}

.mega-nav-container {
  contain: layout style;
}

/* ========== УБИРАЕМ ШЕВЕЛЕНИЕ И МОРГАНИЕ ========== */
.mega-panel-item {
  /* Убираем все transform для стабильности */
  transform: none;
  backface-visibility: hidden;
  will-change: auto;
  transition: background-color 0.2s ease, color 0.2s ease;
  /* Фиксируем позицию */
  position: relative;
  display: block;
  width: 100%;
}

.mega-panel-item:hover {
  /* ТОЛЬКО цветовые изменения, БЕЗ transform */
  background-color: rgba(124, 140, 255, 0.1);
  color: #facc15;
  /* Убираем scale и translate - они вызывают шевеление */
  transform: none;
}
